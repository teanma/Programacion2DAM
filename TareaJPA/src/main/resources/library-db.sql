DROP DATABASE IF EXISTS libraryjpa;

CREATE DATABASE IF NOT EXISTS libraryjpa;

USE libraryjpa;

CREATE TABLE IF NOT EXISTS member (
	id INT AUTO_INCREMENT PRIMARY KEY,
	nif VARCHAR(9) UNIQUE,
	name VARCHAR (100) NOT NULL,
	surname VARCHAR (100) NOT NULL
);

CREATE TABLE IF NOT EXISTS book (
	isbn VARCHAR (13) NOT NULL PRIMARY KEY,
	title VARCHAR(50) NOT NULl,
	author VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS book_genre (
	isbn VARCHAR (13) NOT NULL,
	genre VARCHAR(50) NOT NULl,
	PRIMARY KEY(isbn, genre),
	CONSTRAINT FK_BOOK_GENRE
	FOREIGN KEY (isbn)
	REFERENCES book (isbn)
	ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS book_lend (
	member_id INT NOT NULL,
	isbn VARCHAR(50) NOT NULl,
	lend_date DATE NOT NULL,
	PRIMARY KEY(member_id, isbn, lend_date),
	CONSTRAINT FK_BOOK_LEND
	FOREIGN KEY (isbn)
	REFERENCES book (isbn)
	ON DELETE CASCADE,
	CONSTRAINT FK_MEMBER_LEND
	FOREIGN KEY (member_id)
	REFERENCES member (id)
	ON DELETE CASCADE
);
